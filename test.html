<!DOCTYPE html>
<html>
<head>
    <title>API æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce7ff; color: #004085; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; }
        #log { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ API é€£é€šæ€§æ¸¬è©¦</h1>
    
    <div>
        <label>API ç¶²å€:</label><br>
        <input type="text" id="apiUrl" style="width: 100%; padding: 5px; margin: 5px 0;" 
               placeholder="https://script.google.com/macros/s/YOUR_ID/exec">
    </div>
    
    <div>
        <button onclick="testGet()">æ¸¬è©¦ GET è«‹æ±‚</button>
        <button onclick="testPost()">æ¸¬è©¦ POST è«‹æ±‚</button>
        <button onclick="testCheckDaily()">æ¸¬è©¦æ¯æ—¥æª¢æŸ¥</button>
        <button onclick="clearLog()">æ¸…é™¤è¨˜éŒ„</button>
    </div>
    
    <div id="results"></div>
    <div id="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showResult(message, isSuccess) {
            const resultsDiv = document.getElementById('results');
            const resultClass = isSuccess ? 'success' : 'error';
            resultsDiv.innerHTML = `<div class="test-result ${resultClass}">${message}</div>`;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        async function testGet() {
            const apiUrl = document.getElementById('apiUrl').value;
            if (!apiUrl) {
                showResult('è«‹å…ˆè¼¸å…¥ API ç¶²å€', false);
                return;
            }

            log('é–‹å§‹æ¸¬è©¦ GET è«‹æ±‚...');
            log('API ç¶²å€: ' + apiUrl);

            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    mode: 'cors'
                });

                log('å›æ‡‰ç‹€æ…‹: ' + response.status + ' ' + response.statusText);

                if (response.ok) {
                    const data = await response.text();
                    log('å›æ‡‰å…§å®¹: ' + data);
                    showResult('âœ… GET è«‹æ±‚æˆåŠŸï¼', true);
                } else {
                    log('âŒ GET è«‹æ±‚å¤±æ•—: ' + response.status);
                    showResult('âŒ GET è«‹æ±‚å¤±æ•—: ' + response.status, false);
                }

            } catch (error) {
                log('âŒ GET è«‹æ±‚éŒ¯èª¤: ' + error.message);
                showResult('âŒ GET è«‹æ±‚éŒ¯èª¤: ' + error.message, false);
            }
        }

        async function testPost() {
            const apiUrl = document.getElementById('apiUrl').value;
            if (!apiUrl) {
                showResult('è«‹å…ˆè¼¸å…¥ API ç¶²å€', false);
                return;
            }

            log('é–‹å§‹æ¸¬è©¦åŸºæœ¬ POST è«‹æ±‚...');
            
            const testData = {
                act: 'test',
                message: 'hello'
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                log('å›æ‡‰ç‹€æ…‹: ' + response.status + ' ' + response.statusText);

                if (response.ok) {
                    const data = await response.text();
                    log('å›æ‡‰å…§å®¹: ' + data);
                    showResult('âœ… POST è«‹æ±‚æˆåŠŸï¼', true);
                } else {
                    log('âŒ POST è«‹æ±‚å¤±æ•—: ' + response.status);
                    showResult('âŒ POST è«‹æ±‚å¤±æ•—: ' + response.status, false);
                }

            } catch (error) {
                log('âŒ POST è«‹æ±‚éŒ¯èª¤: ' + error.message);
                showResult('âŒ POST è«‹æ±‚éŒ¯èª¤: ' + error.message, false);
            }
        }

        async function testCheckDaily() {
            const apiUrl = document.getElementById('apiUrl').value;
            if (!apiUrl) {
                showResult('è«‹å…ˆè¼¸å…¥ API ç¶²å€', false);
                return;
            }

            log('é–‹å§‹æ¸¬è©¦æ¯æ—¥æª¢æŸ¥ API...');
            
            const checkData = {
                act: 'checkDaily',
                userId: 'test-user-123'
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(checkData)
                });

                log('å›æ‡‰ç‹€æ…‹: ' + response.status + ' ' + response.statusText);

                if (response.ok) {
                    const responseText = await response.text();
                    log('åŸå§‹å›æ‡‰: ' + responseText);
                    
                    try {
                        const data = JSON.parse(responseText);
                        log('è§£æå¾Œçš„ JSON: ' + JSON.stringify(data, null, 2));
                        
                        if (data.success !== undefined) {
                            showResult('âœ… æ¯æ—¥æª¢æŸ¥ API æ­£å¸¸é‹ä½œï¼å›æ‡‰: ' + data.msg, true);
                        } else {
                            showResult('âš ï¸ API å›æ‡‰æ ¼å¼ç•°å¸¸', false);
                        }
                    } catch (parseError) {
                        log('âŒ JSON è§£æå¤±æ•—: ' + parseError.message);
                        showResult('âŒ API å›æ‡‰ä¸æ˜¯æœ‰æ•ˆçš„ JSON', false);
                    }
                } else {
                    log('âŒ æ¯æ—¥æª¢æŸ¥è«‹æ±‚å¤±æ•—: ' + response.status);
                    showResult('âŒ æ¯æ—¥æª¢æŸ¥è«‹æ±‚å¤±æ•—: ' + response.status, false);
                }

            } catch (error) {
                log('âŒ æ¯æ—¥æª¢æŸ¥éŒ¯èª¤: ' + error.message);
                showResult('âŒ æ¯æ—¥æª¢æŸ¥éŒ¯èª¤: ' + error.message, false);
            }
        }

        // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('API æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            log('è«‹è¼¸å…¥æ‚¨çš„ Google Apps Script API ç¶²å€é€²è¡Œæ¸¬è©¦');
        });
    </script>
</body>
</html>
